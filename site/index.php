<?php 
    require("../config.php");
    session_start();
?>


<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>OUTBREAK MONITORING - City of Balanga</title>

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom fonts for this template -->
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
  <link href='https://fonts.googleapis.com/css?family=Kaushan+Script' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700' rel='stylesheet' type='text/css'>

  <!-- Custom styles for this template -->
  <link href="css/agency.css" rel="stylesheet">

</head>

<body id="page-top">

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="mainNav">
    <div class="container">
      <a class="navbar-brand js-scroll-trigger" href="#page-top">City Of Balanga</a>
      <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        Menu
        <i class="fas fa-bars"></i>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav text-uppercase ml-auto">
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#services">About</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#portfolio">Tips</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#about">Alerts</a>
          </li>
          <!--
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#team">Team</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#contact">Contact</a>
          </li>!-->
        </ul>
      </div>
    </div>
  </nav>

  <!-- Header -->
  <header class="masthead">
    <div class="container">
      <div class="intro-text">
        <div style="background: rgba(128,128,128, 0.5); !important;border-radius: 20px;padding: 20px 20px 20px 20px">
          
            <div class="intro-lead-in">Welcome to Outbreak Monitoring</div>
            <img src="\assets\PUBLIC WEBSITE\images\logo.png" style="max-width: 60%; max-height: 60%">
            <div class="intro-heading text-uppercase">City of Balanga - Bataan</div>
        </div>
      </div>
    </div>
  </header>
  <!-- Services -->
  <section id="services">
    <div class="container">
      <div class="row">
        <div class="col-lg-12 text-center">
          <h2 class="section-heading text-uppercase">About Balanga City</h2>
          <h3 class="section-subheading text-muted"></h3>
        </div>
      </div>
      <div class="row text-center">
        <div class="col-md-6">
          <span class="fa-stack fa-4x">
            <i class="fas fa-circle fa-stack-2x text-primary"></i>
            <i class="fas fa-eye fa-stack-1x fa-inverse"></i>
          </span>
          <h4 class="service-heading">Vision</h4>
          <p class="text-muted">A city with constituents who value a healthy lifestyle and actively participate in community healh development brought about by competent and committed health workers who promote well-being and protect the health if its citizens.</p>
        </div>
        <div class="col-md-6">
          <span class="fa-stack fa-4x">
            <i class="fas fa-circle fa-stack-2x text-primary"></i>
            <i class="fas fa-bullseye fa-stack-1x fa-inverse"></i>
          </span>
          <h4 class="service-heading">Mission </h4>
          <p class="text-muted">To implement the DOH programs and create the proper physical and social environments, expanding communiy resource and developing health workers to their maximun potentials.</p>
        </div>
        
      </div>      
      <div class="row text-center">
        <div class="col-md-6">
          <span class="fa-stack fa-4x">
            <i class="fas fa-circle fa-stack-2x text-primary"></i>
            <i class="fas fa-list fa-stack-1x fa-inverse"></i>
          </span>
          <h4 class="service-heading">Guiding Principles</h4>
         <ul class="list-group list-group-flush">
            <li class="list-group-item">Health is a basic human right.</li>
            <li class="list-group-item">The greatest good for the greates number.</li>
            <li class="list-group-item">Health is continuum.</li>
            <li class="list-group-item">Belief in the consultative process towards decision and action</li>
            <li class="list-group-item">The concept of primary health embodies needs for self-suffiency.</li>
            <li class="list-group-item">Honesty and professionalism are the prime importance in a job.</li>
            <li class="list-group-item">Belief in the DOH being in the forefront of government activities, and that CHO is part of a larger group.</li>
            <li class="list-group-item">The health professional who holds unique position in the community, is expected to lead not only on the health matters but also in their community concerns.</li>
        </ul>
        </div>
        <div class="col-md-6">
          <span class="fa-stack fa-4x">
            <i class="fas fa-circle fa-stack-2x text-primary"></i>
            <i class="fas fa-user-md fa-stack-1x fa-inverse"></i>
          </span>
          <h4 class="service-heading">Commitment Compassion Professionalism Stewardship Objectives </h4>
          <ul class="list-group list-group-flush">
            <li class="list-group-item">To implement health programs and disease prevention activities.</li>
            <li class="list-group-item">To formulate plans and strategies to improve the health condition of the city populace.</li>
            <li class="list-group-item">To execute and enforce laws, ordinances and regulations relating to public health.</li>
            <li class="list-group-item">To conduct information campain pertaining to public health and sanitation and be in frontline of the health services.</li>
            <li class="list-group-item">The health professional who holds unique position in the community, is expected to lead not only on the health matters but also in their community concerns.</li>
        </ul>
        </div>
        
      </div>
    </div>
  </section>

  <!-- Portfolio Grid -->
  <div id="portfolio">
  <section class="bg-light" id="portfolio">
    <div class="container">
      <div class="row">
        <div class="col-lg-12 text-center">
          <h2 class="section-heading text-uppercase">Tips</h2>
          <h3 class="section-subheading text-muted">Health Tips</h3>
        </div>
      </div>
      <div class="row">

        <div class="col-md-4 col-sm-6 portfolio-item" style="background-color: white" v-for="(tip,index,key) in tips">
          <a class="portfolio-link" data-toggle="modal" v-bind:href="'#portfolioModal'+index">
            <div class="portfolio-hover">
              <div class="portfolio-hover-content" >
                <i class="fas fa-plus fa-3x"></i>
              </div>
            </div>
            <img v-bind:src="tip.img_src" class="img-fluid"  alt="" style="max-width: 350px; max-height: 197px; display: block;
                margin-left: auto;
                margin-right: auto;
                background-color: white">
          </a>
          <div class="portfolio-caption">
            <h4>{{tip.title}}</h4>
            <p class="text-muted">{{tip.subtitle}}</p>
            <p class="text-muted"> 
            By <b>{{tip.created_by}}</b> on 
            <b>{{tip.created_at}}</b></i> </p>

          </div>
        </div>

      </div>
    </div>
  </section>
  </div>

  <!-- About -->
  <div id="about">
  <section id="about">
    <div class="container">
      <div class="row">
        <div class="col-lg-12 text-center">
          <h2 class="section-heading text-uppercase">Alerts</h2>
          <h3 class="section-subheading text-muted">Outbreak Information About Balanga City</h3>

        </div>
      </div>
      <form>
      <div class="row">

        <div class="col-12 row">

          <div class="col-5">
              <select name="year" id="year" class="form-control filter"  required="">
              <option value="">Please select</option>
              <?php 
              $years = getYearsInRecords();

              foreach ($years as $year) {

              ?>
              <option value="<?=$year['year']?>"><?=$year['year']?></option>
              <?php 
              }

              ?>
              </select>   
          </div>
          <div class="col-5">          
            <select name="disease_id" id="disease_id" class="form-control filter" required="">
              <option value="">Please select</option>
              <?php 
                $diseases = getDiseases();

                foreach ($diseases as $x) {
                
              ?>
              <option value="<?=$x['id']?>"><?=$x['name']?></option>
              <?php 
              }

              ?>
            </select>
          </div>
          <div class="2">
            <button class="btn btn-primary" style="width: 100%"> Go </button>
          </div>

        </div>
        <div class="col-12">
          <h2 class="text-center"> Geographical Status </h2>                            
          <iframe src="../admin/map.php?year=2019" frameborder="0" height="600px" width = "100%" id="iframe_1"></iframe>
        </div>
        <div class="col-12" >
          <h2 class="text-center"> Disease Rank (<?=date("F")." ".date("Y")?>)</h2>

           <table class="table table-condensed">
              <thead>
                <th></th>
                <th>Disease</th>
                <th># of Cases <i>(as of today)</i></th>
              </thead>
              <tbody>

                <tr v-for="(rank,i,k) in ranks">
                  <td> {{i+1}}</td>
                  <td> {{rank.name}} </td>
                  <td> {{rank.total}} </td>
                </tr>

              </tbody>
           </table>
        </div>
        <div class="col-12">
          <h2 class="text-center"> Graphical Representation </h2>
          <iframe src="../admin/graph_month.php?year=2019" frameborder="0" height="470px" width="100%"></iframe>
        </div>

        <div class="col-12">
          <h1> INFORMATION </h1>
        
         <div v-for="(msg, key, item) in sms">
            <div class="list-group">        
              <span href="" class="list-group-item list-group-item-action flex-column align-items-start non-clickable">
                <div class="d-flex w-100 justify-content-between">

                  <h5 class="">{{msg.disease_name }} ALERT AT {{msg.barangay_name}}</h5><br>
                  <small class="text-muted">{{msg.human_date}}</small>
                </div>
                <span v-html="msg.d_message"></span><br>
                <small class="text-muted"><i>Auto Generated on {{msg.created_at}}</i></small>
              </span>

            </div>
        </div>
        </div>
      </div>
    </div>
    </form>
  </section>
  </div>


  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <span class="copyright">Balanga City © Copyright 2019.</span>
        </div>
      </div>
    </div>
  </footer>

  <!-- Portfolio Modals -->


  <div id="modal">
  <div v-for="(tip, index, key) in tips " class="portfolio-modal modal fade" v-bind:id="'portfolioModal'+index" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="close-modal" data-dismiss="modal">
          <div class="lr">
            <div class="rl"></div>
          </div>
        </div>
        <div class="container">
          <div class="row">
            <div class="col-lg-8 mx-auto">
              <div class="modal-body">
                <!-- Project Details Go Here -->
                <h2 class="text-uppercase">{{tip.title}}</h2>
                <p class="item-intro text-muted">{{tip.subtitle}}</p>

                <img class="img-fluid d-block mx-auto" v-bind:src="tip.img_src" alt="" >
                <p>{{tip.body}}</p>
                <ul class="list-inline">
                  <li><i>Posted by: 
                    <b>{{tip.created_by}} </b> on 
                    <b>{{tip.created_at}}</b></i> 
                  </li>
               
                </ul>
                <button class="btn btn-primary" data-dismiss="modal" type="button">
                  <i class="fas fa-times"></i>
                  Close Tip</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>

  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Plugin JavaScript -->
  <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

  <!-- Contact form JavaScript -->
  <script src="js/jqBootstrapValidation.js"></script>
  <script src="js/contact_me.js"></script>

  <!-- Custom scripts for this template -->
  <script src="js/agency.min.js"></script>
  <script src="../assets/js/vue.js"></script>
  <script src="../assets/js/moment.js"></script>
  <script src="../assets/js/helper.js"></script>
  <script src="https://js.pusher.com/4.4/pusher.min.js"></script>
  <script>
    //Pusher.logToConsole = true;
    var pusher = new Pusher('21ce5477f6d4ba94c932', {
      cluster: 'ap1',
      forceTLS: true
    });
    var channel = pusher.subscribe('my-channel');
     channel.bind('record.create', function(data) {
      location.reload()
     })
    <?php
      $year = date("Y");
      $disease_id = "";
      if(isset($_GET['year'])){
        $year = $_GET['year'];
      }
      if(isset($_GET['disease_id'])){
        $disease_id = $_GET['disease_id'];
      }

    ?>
   var about = new Vue ({
      el : "#about",
      data : {
        ranks: <?=getDiseaseRank(date('Y'))?>,
        sms: <?=json_encode(getSMSAlert())?>,
        limit: <?=getCountOfSMS()?>
      },
      created(){
          for (var i = 0; i <= this.limit-1; i++) {
              //console.log(this.tips[i]['created_at'])
              var date = new Date(this.sms[i]['created_at'])
              this.sms[i].human_date = moment(date).fromNow()
          }    
      }

   })
   var portfolio = new Vue ({
      el : "#portfolio",
      data : {
        tips : <?=json_encode(getTips(false))?>,
        limit: <?=getCountOfTips()?>
      },
      mounted(){
          for (var i = 0; i <= this.limit-1; i++) {
              //console.log(this.tips[i]['created_at'])
              var date = new Date(this.tips[i]['created_at'])
              this.tips[i]['created_at'] = moment(date).fromNow()
          }    
      }

   })
   var modal = new Vue ({
      el : "#modal",
      data : {
        tips : <?=json_encode(getTips(false))?>,
        limit: <?=getCountOfTips()?>
      },
      mounted(){

          for (var i = 0; i <= this.limit-1; i++) {
              //console.log(this.tips[i]['created_at'])
              var date = new Date(this.tips[i]['created_at'])
              this.tips[i]['created_at'] = moment(date).fromNow()


          }    
      }

   })
   $(function(){
      var year = '<?=$year?>'

      var disease_id = '<?=$disease_id?>'
      
      $("#year").val(year)
      $("#disease_id").val(disease_id)

     
  
      if(disease_id>0){
        $("#iframe_1").attr("src","../admin/map.php?year="+year+"&disease_id="+disease_id)
        
      }
   })
  </script>  

</body>

</html>
